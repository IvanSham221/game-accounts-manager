<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–∫—Ü–∏–∏ PS Store - –ú–µ–Ω–µ–¥–∂–µ—Ä –∞–∫–∫–∞—É–Ω—Ç–æ–≤</title>
    <link rel="stylesheet" href="style.css?v=20250115">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å–∫–∏–¥–æ–∫ */
        .discounts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .discount-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .discount-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .discount-card.high-discount {
            border-top: 4px solid #ef4444;
        }
        
        .discount-card.no-discount {
            opacity: 0.7;
        }
        
        .discount-percent {
            font-size: 1.8em;
            font-weight: 800;
            color: #ef4444;
            text-shadow: 0 2px 4px rgba(239, 68, 68, 0.2);
        }
        
        .region-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
            margin-right: 5px;
        }
        
        .region-tr {
            background: linear-gradient(135deg, #e63946 0%, #a4161a 100%);
            color: white;
        }
        
        .region-ua {
            background: linear-gradient(135deg, #0057b7 0%, #ffd700 100%);
            color: white;
        }
        
        .price-old {
            text-decoration: line-through;
            color: #94a3b8;
            font-size: 0.9em;
        }
        
        .price-new {
            font-size: 1.3em;
            font-weight: 700;
            color: #1e293b;
        }
        
        .discount-meta {
            display: flex;
            justify-content: space-between;
            color: #64748b;
            font-size: 0.85em;
            margin-top: 10px;
        }
        
        .no-discounts {
            text-align: center;
            padding: 50px 20px;
            color: #64748b;
        }
        
        .no-discounts i {
            font-size: 3em;
            margin-bottom: 20px;
            color: #cbd5e1;
        }
        
        .discounts-controls {
            background: #f8fafc;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
            margin-bottom: 20px;
        }
        
        .game-image {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
            margin-right: 15px;
        }
        
        .game-info {
            flex: 1;
        }
        
        .discount-status {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .status-on-sale {
            background: #dcfce7;
            color: #166534;
        }
        
        .status-no-discount {
            background: #f1f5f9;
            color: #64748b;
        }
        
        .status-error {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .checking-progress {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 1px solid #bfdbfe;
        }
        
        @media (max-width: 768px) {
            .discounts-grid {
                grid-template-columns: 1fr;
            }
            
            .discount-card {
                padding: 15px;
            }
            
            .game-image {
                width: 80px;
                height: 80px;
                margin-right: 10px;
            }
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .new-discount {
            animation: pulse 2s infinite;
            position: relative;
        }
        
        .new-discount::after {
            content: "NEW";
            position: absolute;
            top: 10px;
            right: 10px;
            background: #f72585;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1><span>üéÆ</span><span>–ê–∫—Ü–∏–∏ PS Store</span></h1>
        
        <div class="nav-buttons"></div>

        <div class="section">
            <h2><i class="fas fa-fire"></i> –°–∫–∏–¥–∫–∏ –Ω–∞ –Ω–∞—à–∏ –∏–≥—Ä—ã</h2>
            
            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div id="discountsStats" class="stats-grid" style="margin: 20px 0; display: none;"></div>
            
            <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
            <div class="discounts-controls">
                <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-bottom: 20px;">
                    <div style="flex: 1; min-width: 200px;">
                        <label for="searchDiscounts" style="display: block; margin-bottom: 8px; font-weight: 600; color: #2d3748;">
                            <i class="fas fa-search"></i> –ü–æ–∏—Å–∫ –∏–≥—Ä—ã:
                        </label>
                        <input type="text" id="searchDiscounts" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–≥—Ä—ã..." class="input" 
                               onkeyup="searchDiscounts()">
                    </div>
                    
                    <div style="flex: 1; min-width: 200px;">
                        <label for="filterRegion" style="display: block; margin-bottom: 8px; font-weight: 600; color: #2d3748;">
                            <i class="fas fa-globe"></i> –†–µ–≥–∏–æ–Ω:
                        </label>
                        <select id="filterRegion" class="input" onchange="filterDiscounts()">
                            <option value="all">–í—Å–µ —Ä–µ–≥–∏–æ–Ω—ã</option>
                            <option value="TR">üáπüá∑ –¢—É—Ä—Ü–∏—è</option>
                            <option value="UA">üá∫üá¶ –£–∫—Ä–∞–∏–Ω–∞</option>
                        </select>
                    </div>
                    
                    <div style="flex: 1; min-width: 200px;">
                        <label for="filterDiscount" style="display: block; margin-bottom: 8px; font-weight: 600; color: #2d3748;">
                            <i class="fas fa-percentage"></i> –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å–∫–∏–¥–∫–∞:
                        </label>
                        <select id="filterDiscount" class="input" onchange="filterDiscounts()">
                            <option value="0">–õ—é–±–∞—è —Å–∫–∏–¥–∫–∞</option>
                            <option value="30">–û—Ç 30%</option>
                            <option value="50">–û—Ç 50%</option>
                            <option value="60">–û—Ç 60%</option>
                            <option value="70">–û—Ç 70%</option>
                            <option value="80">–û—Ç 80%</option>
                        </select>
                    </div>
                </div>
                
                <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                    <button onclick="updateDiscounts(true)" class="btn btn-success" style="flex: 1;">
                        <i class="fas fa-sync-alt"></i> –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∫–∏–¥–∫–∏ —Å–µ–π—á–∞—Å
                    </button>
                    
                    <button onclick="updateGameImages()" class="btn btn-primary" style="flex: 1;">
                        <i class="fas fa-image"></i> –û–±–Ω–æ–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                    </button>
                    
                    <button onclick="clearDiscountsCache()" class="btn btn-warning" style="flex: 1;">
                        <i class="fas fa-trash"></i> –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à
                    </button>
                </div>
                
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e2e8f0;">
                    <div style="display: flex; align-items: center; gap: 10px; color: #64748b;">
                        <i class="fas fa-info-circle"></i>
                        <small>–î–æ–±–∞–≤–ª—è–π—Ç–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∏–≥—Ä—ã –≤ —Ä–∞–∑–¥–µ–ª–µ "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–∞–º–∏". –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–∫–∏–¥–∫–∏ –∫–∞–∂–¥—ã–µ 4 —á–∞—Å–∞.</small>
                    </div>
                </div>
            </div>
            
            <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –ø—Ä–æ–≤–µ—Ä–∫–∏ -->
            <div id="discountsProgress" class="checking-progress" style="display: none;"></div>
            
            <!-- –ó–∞–≥—Ä—É–∑–∫–∞ -->
            <div id="discountsLoading" class="loading-container" style="text-align: center; padding: 40px; display: none;">
                <div class="loading" style="display: inline-block; width: 40px; height: 40px;"></div>
                <p style="margin-top: 15px; color: #64748b;">–ó–∞–≥—Ä—É–∂–∞—é —Å–ø–∏—Å–æ–∫ –∏–≥—Ä...</p>
            </div>
            
            <!-- –°–æ–æ–±—â–µ–Ω–∏–µ "–Ω–µ—Ç –∏–≥—Ä" -->
            <div id="noGamesAlert" style="display: none; text-align: center; padding: 40px;">
                <div style="font-size: 60px; color: #cbd5e1; margin-bottom: 20px;">üéÆ</div>
                <h3>–ù–µ—Ç –∏–≥—Ä –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è</h3>
                <p style="color: #64748b; margin: 15px 0;">–î–æ–±–∞–≤—å—Ç–µ –∏–≥—Ä—ã —Å–æ —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ PS Store –≤ —Ä–∞–∑–¥–µ–ª–µ "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–∞–º–∏"</p>
                <button onclick="location.href='games.html'" class="btn btn-primary">
                    <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä—ã
                </button>
            </div>
            
            <!-- –°–ø–∏—Å–æ–∫ —Å–∫–∏–¥–æ–∫ -->
            <div id="discountsList" class="discounts-grid" style="display: none;"></div>
            
            <!-- –ò–≥—Ä—ã –±–µ–∑ —Å–∫–∏–¥–æ–∫ -->
            <div id="noDiscountsSection" style="display: none; margin-top: 30px;">
                <h3 style="color: #64748b;"><i class="fas fa-times-circle"></i> –ò–≥—Ä—ã –±–µ–∑ —Å–∫–∏–¥–æ–∫</h3>
                <div id="gamesWithoutDiscounts" class="discounts-grid" style="margin-top: 15px;"></div>
            </div>
        </div>
        
        <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
        <div class="section">
            <h2><i class="fas fa-cog"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è</h2>
            <div class="form-grid">
                <div>
                    <label for="checkInterval" style="display: block; margin-bottom: 8px; font-weight: 600; color: #2d3748;">
                        –ü—Ä–æ–≤–µ—Ä—è—Ç—å –∫–∞–∂–¥—ã–µ:
                    </label>
                    <select id="checkInterval" class="input">
                        <option value="1">1 —á–∞—Å</option>
                        <option value="2">2 —á–∞—Å–∞</option>
                        <option value="4" selected>4 —á–∞—Å–∞</option>
                        <option value="6">6 —á–∞—Å–æ–≤</option>
                        <option value="12">12 —á–∞—Å–æ–≤</option>
                        <option value="24">24 —á–∞—Å–∞</option>
                    </select>
                </div>
                
                <div>
                    <label for="minDiscountAlert" style="display: block; margin-bottom: 8px; font-weight: 600; color: #2d3748;">
                        –£–≤–µ–¥–æ–º–ª—è—Ç—å –æ—Ç:
                    </label>
                    <select id="minDiscountAlert" class="input">
                        <option value="30">30% —Å–∫–∏–¥–∫–∏</option>
                        <option value="50">50% —Å–∫–∏–¥–∫–∏</option>
                        <option value="60" selected>60% —Å–∫–∏–¥–∫–∏</option>
                        <option value="70">70% —Å–∫–∏–¥–∫–∏</option>
                        <option value="80">80% —Å–∫–∏–¥–∫–∏</option>
                    </select>
                </div>
                
                <div>
                    <label for="autoCheck" style="display: block; margin-bottom: 8px; font-weight: 600; color: #2d3748;">
                        –ê–≤—Ç–æ–ø—Ä–æ–≤–µ—Ä–∫–∞:
                    </label>
                    <div style="margin-top: 10px;">
                        <input type="checkbox" id="autoCheck" checked style="width: 18px; height: 18px;">
                        <label for="autoCheck" style="margin-left: 8px; font-weight: 500; color: #4b5563;">
                            –í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –ø—Ä–æ–≤–µ—Ä–∫—É
                        </label>
                    </div>
                </div>
                
                <div>
                    <label for="notifyBigDiscounts" style="display: block; margin-bottom: 8px; font-weight: 600; color: #2d3748;">
                        –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:
                    </label>
                    <div style="margin-top: 10px;">
                        <input type="checkbox" id="notifyBigDiscounts" checked style="width: 18px; height: 18px;">
                        <label for="notifyBigDiscounts" style="margin-left: 8px; font-weight: 500; color: #4b5563;">
                            –£–≤–µ–¥–æ–º–ª—è—Ç—å –æ –±–æ–ª—å—à–∏—Ö —Å–∫–∏–¥–∫–∞—Ö
                        </label>
                    </div>
                </div>
                
                <button onclick="saveDiscountSettings()" class="btn btn-primary" style="grid-column: 1 / -1;">
                    <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                </button>
            </div>
            
            <div style="margin-top: 20px; padding: 15px; background: #f8fafc; border-radius: 10px; border: 1px solid #e2e8f0;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <div style="font-weight: 600; color: #2d3748;">–ü–æ—Å–ª–µ–¥–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞:</div>
                        <div id="lastCheckTime" style="color: #64748b;">–ù–∏–∫–æ–≥–¥–∞</div>
                    </div>
                    <div>
                        <div style="font-weight: 600; color: #2d3748;">–°–ª–µ–¥—É—é—â–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:</div>
                        <div id="nextCheckTime" style="color: #64748b;">–ù–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–≤–µ—Ä–æ–∫ -->
        <div class="section">
            <h2><i class="fas fa-history"></i> –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–≤–µ—Ä–æ–∫</h2>
            <div id="checkHistory" style="max-height: 300px; overflow-y: auto; padding: 10px;">
                <div class="empty">–ü—Ä–æ–≤–µ—Ä–æ–∫ –µ—â–µ –Ω–µ –±—ã–ª–æ</div>
            </div>
        </div>
        
        <!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è -->
        <div class="section" style="background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);">
            <h2><i class="fas fa-question-circle"></i> –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px;">
                <div style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #bfdbfe;">
                    <div style="font-size: 2em; margin-bottom: 10px;">1Ô∏è‚É£</div>
                    <h4 style="margin: 0 0 10px 0; color: #1e293b;">–î–æ–±–∞–≤—å—Ç–µ –∏–≥—Ä—ã</h4>
                    <p style="color: #64748b; margin: 0;">–í —Ä–∞–∑–¥–µ–ª–µ "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–∞–º–∏" –¥–æ–±–∞–≤—å—Ç–µ –∏–≥—Ä—ã —Å —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ —Ç—É—Ä–µ—Ü–∫–∏–π –∏ —É–∫—Ä–∞–∏–Ω—Å–∫–∏–π PS Store</p>
                </div>
                
                <div style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #bfdbfe;">
                    <div style="font-size: 2em; margin-bottom: 10px;">2Ô∏è‚É£</div>
                    <h4 style="margin: 0 0 10px 0; color: #1e293b;">–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∫–∏–¥–∫–∏</h4>
                    <p style="color: #64748b; margin: 0;">–ù–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∫–∏–¥–∫–∏ —Å–µ–π—á–∞—Å" –∏–ª–∏ —Å–∏—Å—Ç–µ–º–∞ —Å–¥–µ–ª–∞–µ—Ç —ç—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</p>
                </div>
                
                <div style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #bfdbfe;">
                    <div style="font-size: 2em; margin-bottom: 10px;">3Ô∏è‚É£</div>
                    <h4 style="margin: 0 0 10px 0; color: #1e293b;">–ü–æ–ª—É—á–∏—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h4>
                    <p style="color: #64748b; margin: 0;">–°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–∏—Ç –≤–∞—Å –æ –±–æ–ª—å—à–∏—Ö —Å–∫–∏–¥–∫–∞—Ö (–±–æ–ª–µ–µ 60%)</p>
                </div>
            </div>
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å–∫—Ä–∏–ø—Ç—ã -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="firebase.js"></script>
    <script src="security.js"></script>
    <script src="script.js?v=20250115"></script>
    
    <!-- API –¥–ª—è PS Store -->
    <script src="psstore-api.js"></script>
    
    <!-- –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Å–∫–∏–¥–æ–∫ -->
    <script src="discounts.js?v=20250115"></script>
    
    <script>
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let discountsManager = null;
        let currentDiscounts = [];
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–∫–∏–¥–æ–∫ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            
            // –°–æ–∑–¥–∞–µ–º –º–µ–Ω–µ–¥–∂–µ—Ä —Å–∫–∏–¥–æ–∫
            discountsManager = new DiscountsManager();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            loadDiscountSettings();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
            updateCheckTimes();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –ø—Ä–æ–≤–µ—Ä–æ–∫
            updateCheckHistory();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
            setTimeout(() => {
                initDiscountsPage();
            }, 500);
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
            setupAutoRefresh();
        });
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å–∫–∏–¥–æ–∫
        function initDiscountsPage() {
            const loadingEl = document.getElementById('discountsLoading');
            const noGamesAlert = document.getElementById('noGamesAlert');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ –∏–≥—Ä—ã –≤ –±–∞–∑–µ
            const myGames = JSON.parse(localStorage.getItem('games')) || [];
            
            if (myGames.length === 0) {
                loadingEl.style.display = 'none';
                noGamesAlert.style.display = 'block';
                return;
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–∫–∏–¥–∫–∏
            const cachedDiscounts = JSON.parse(localStorage.getItem('discountsResults')) || [];
            
            if (cachedDiscounts.length > 0) {
                console.log('üì¶ –ó–∞–≥—Ä—É–∂–µ–Ω—ã –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–∫–∏–¥–∫–∏:', cachedDiscounts.length);
                displayDiscounts(cachedDiscounts);
                loadingEl.style.display = 'none';
            } else {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–≥–¥–∞ –±—ã–ª–∞ –ø–æ—Å–ª–µ–¥–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞
                const lastCheck = localStorage.getItem('lastDiscountCheck');
                const hoursSinceLastCheck = lastCheck ? 
                    (Date.now() - new Date(lastCheck)) / (1000 * 60 * 60) : 24;
                
                // –ï—Å–ª–∏ –¥–∞–≤–Ω–æ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–ª–∏, –∑–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É
                if (hoursSinceLastCheck > 4) {
                    updateDiscounts(false);
                } else {
                    loadingEl.style.display = 'none';
                    document.getElementById('discountsList').innerHTML = `
                        <div class="no-discounts" style="grid-column: 1 / -1;">
                            <i class="fas fa-search"></i>
                            <h3>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Å–∫–∏–¥–∫–∞—Ö</h3>
                            <p>–ù–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∫–∏–¥–∫–∏ —Å–µ–π—á–∞—Å" —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ</p>
                        </div>
                    `;
                    document.getElementById('discountsList').style.display = 'block';
                }
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∫–∏–¥–æ–∫
        async function updateDiscounts(force = false) {
            try {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
                document.getElementById('discountsLoading').style.display = 'block';
                document.getElementById('discountsList').style.display = 'none';
                document.getElementById('noDiscountsSection').style.display = 'none';
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É
                const results = await discountsManager.checkDiscounts(force);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                displayDiscounts(results);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏
                localStorage.setItem('lastDiscountCheck', new Date().toISOString());
                updateCheckTimes();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏—Å—Ç–æ—Ä–∏—é
                updateCheckHistory();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                const bigDiscounts = results.filter(r => 
                    r.discounts.TR?.discount >= 60 || r.discounts.UA?.discount >= 60
                );
                
                if (bigDiscounts.length > 0) {
                    showNotification(`üî• –ù–∞–π–¥–µ–Ω–æ ${bigDiscounts.length} –±–æ–ª—å—à–∏—Ö —Å–∫–∏–¥–æ–∫!`, 'success', 5000);
                } else {
                    showNotification(`‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ ${results.length} –∏–≥—Ä —Å–æ —Å–∫–∏–¥–∫–∞–º–∏`, 'success');
                }
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–∫–∏–¥–æ–∫:', error);
                showNotification('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å–∫–∏–¥–æ–∫', 'error');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                const cached = JSON.parse(localStorage.getItem('discountsResults')) || [];
                if (cached.length > 0) {
                    displayDiscounts(cached);
                }
            } finally {
                document.getElementById('discountsLoading').style.display = 'none';
            }
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–∫–∏–¥–æ–∫
        function displayDiscounts(discountsData) {
            currentDiscounts = discountsData;
            const container = document.getElementById('discountsList');
            const statsContainer = document.getElementById('discountsStats');
            const noDiscountsSection = document.getElementById('noDiscountsSection');
            const noDiscountsContainer = document.getElementById('gamesWithoutDiscounts');
            
            if (!container) return;
            
            // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è
            let filteredDiscounts = [...discountsData];
            const searchTerm = document.getElementById('searchDiscounts')?.value.toLowerCase() || '';
            const regionFilter = document.getElementById('filterRegion')?.value || 'all';
            const discountFilter = parseInt(document.getElementById('filterDiscount')?.value || '0');
            
            if (searchTerm) {
                filteredDiscounts = filteredDiscounts.filter(item =>
                    item.game.name.toLowerCase().includes(searchTerm)
                );
            }
            
            if (regionFilter !== 'all') {
                filteredDiscounts = filteredDiscounts.filter(item => 
                    item.discounts[regionFilter] !== null
                );
            }
            
            if (discountFilter > 0) {
                filteredDiscounts = filteredDiscounts.filter(item => {
                    const trDiscount = item.discounts.TR?.discount || 0;
                    const uaDiscount = item.discounts.UA?.discount || 0;
                    return trDiscount >= discountFilter || uaDiscount >= discountFilter;
                });
            }
            
            // –†–∞–∑–¥–µ–ª—è–µ–º –Ω–∞ –∏–≥—Ä—ã —Å–æ —Å–∫–∏–¥–∫–∞–º–∏ –∏ –±–µ–∑
            const gamesWithDiscounts = filteredDiscounts.filter(item => 
                item.discounts.TR || item.discounts.UA
            );
            
            const gamesWithoutDiscounts = filteredDiscounts.filter(item => 
                !item.discounts.TR && !item.discounts.UA
            );
            
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            if (statsContainer && gamesWithDiscounts.length > 0) {
                let totalDiscount = 0;
                let discountCount = 0;
                let trCount = 0;
                let uaCount = 0;
                
                gamesWithDiscounts.forEach(item => {
                    if (item.discounts.TR) {
                        totalDiscount += item.discounts.TR.discount;
                        discountCount++;
                        trCount++;
                    }
                    if (item.discounts.UA) {
                        totalDiscount += item.discounts.UA.discount;
                        discountCount++;
                        uaCount++;
                    }
                });
                
                const avgDiscount = discountCount > 0 ? Math.round(totalDiscount / discountCount) : 0;
                
                statsContainer.innerHTML = `
                    <div class="stat-card">
                        <div class="stat-value">${gamesWithDiscounts.length}</div>
                        <div class="stat-label">–ò–≥—Ä —Å–æ —Å–∫–∏–¥–∫–∞–º–∏</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${avgDiscount}%</div>
                        <div class="stat-label">–°—Ä–µ–¥–Ω—è—è —Å–∫–∏–¥–∫–∞</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${trCount}</div>
                        <div class="stat-label">–í –¢—É—Ä—Ü–∏–∏</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${uaCount}</div>
                        <div class="stat-label">–í –£–∫—Ä–∞–∏–Ω–µ</div>
                    </div>
                `;
                statsContainer.style.display = 'grid';
            } else {
                statsContainer.style.display = 'none';
            }
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏–≥—Ä—ã —Å–æ —Å–∫–∏–¥–∫–∞–º–∏
            if (gamesWithDiscounts.length === 0) {
                container.innerHTML = `
                    <div class="no-discounts" style="grid-column: 1 / -1;">
                        <i class="fas fa-search"></i>
                        <h3>${searchTerm ? '–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ' : '–°–∫–∏–¥–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ'}</h3>
                        <p>${searchTerm ? '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å' : '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã'}</p>
                    </div>
                `;
            } else {
                container.innerHTML = gamesWithDiscounts.map(item => {
                    const hasTR = item.discounts.TR;
                    const hasUA = item.discounts.UA;
                    const hasBigDiscount = (hasTR && item.discounts.TR.discount >= 70) || 
                                         (hasUA && item.discounts.UA.discount >= 70);
                    const isNew = (hasTR && item.discounts.TR.isNew) || 
                                 (hasUA && item.discounts.UA.isNew);
                    
                    return `
                        <div class="discount-card ${hasBigDiscount ? 'high-discount' : ''} ${isNew ? 'new-discount' : ''}">
                            <div style="padding: 20px;">
                                <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
                                <div style="display: flex; margin-bottom: 20px;">
                                    ${item.game.imageUrl ? `
                                        <img src="${item.game.imageUrl}" class="game-image">
                                    ` : `
                                        <div class="game-image" style="background: linear-gradient(135deg, #4361ee 0%, #3a56d4 100%); 
                                            display: flex; align-items: center; justify-content: center; color: white; font-size: 2em;">
                                            üéÆ
                                        </div>
                                    `}
                                    <div class="game-info">
                                        <h3 style="margin: 0 0 5px 0; color: #1e293b; font-size: 1.2em;">
                                            ${item.game.name}
                                        </h3>
                                        <div style="color: #64748b; font-size: 0.9em;">
                                            <div>–î–æ–±–∞–≤–ª–µ–Ω–∞: ${item.game.created || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</div>
                                            <div>–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ: ${new Date(item.checkedAt).toLocaleString('ru-RU')}</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- –°–∫–∏–¥–∫–∏ -->
                                ${hasTR ? renderDiscountBlock(item.discounts.TR, 'TR') : ''}
                                ${hasUA ? renderDiscountBlock(item.discounts.UA, 'UA') : ''}
                                
                                <!-- –î–µ–π—Å—Ç–≤–∏—è -->
                                <div style="display: flex; gap: 10px; margin-top: 15px;">
                                    ${item.game.storeLinks?.TR ? `
                                        <button onclick="openDiscountUrl('${item.game.storeLinks.TR}')" 
                                                class="btn btn-small" style="flex: 1; background: #dc2626; color: white;">
                                            üáπüá∑ –¢—É—Ä—Ü–∏—è
                                        </button>
                                    ` : ''}
                                    ${item.game.storeLinks?.UA ? `
                                        <button onclick="openDiscountUrl('${item.game.storeLinks.UA}')" 
                                                class="btn btn-small" style="flex: 1; background: #2563eb; color: white;">
                                            üá∫üá¶ –£–∫—Ä–∞–∏–Ω–∞
                                        </button>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏–≥—Ä—ã –±–µ–∑ —Å–∫–∏–¥–æ–∫
            if (gamesWithoutDiscounts.length > 0) {
                noDiscountsContainer.innerHTML = gamesWithoutDiscounts.map(item => `
                    <div class="discount-card no-discount">
                        <div style="padding: 20px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <h4 style="margin: 0; color: #64748b;">${item.game.name}</h4>
                                <span class="discount-status status-no-discount">
                                    –ù–µ—Ç —Å–∫–∏–¥–æ–∫
                                </span>
                            </div>
                            <div style="color: #94a3b8; font-size: 0.9em;">
                                –ü–æ—Å–ª–µ–¥–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞: ${new Date(item.checkedAt).toLocaleString('ru-RU')}
                            </div>
                        </div>
                    </div>
                `).join('');
                
                noDiscountsSection.style.display = 'block';
            } else {
                noDiscountsSection.style.display = 'none';
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
            container.style.display = 'grid';
        }
        
        // –†–µ–Ω–¥–µ—Ä –±–ª–æ–∫–∞ —Å–∫–∏–¥–∫–∏
        function renderDiscountBlock(discount, region) {
            const daysLeft = discount.validUntil ? 
                Math.ceil((new Date(discount.validUntil) - new Date()) / (1000 * 60 * 60 * 24)) : 0;
            
            return `
                <div style="
                    background: ${region === 'TR' ? '#fff5f5' : '#eff6ff'};
                    padding: 15px;
                    border-radius: 8px;
                    margin-bottom: 10px;
                    border: 1px solid ${region === 'TR' ? '#fecaca' : '#bfdbfe'};
                ">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <span class="region-badge region-${region.toLowerCase()}">
                            ${region === 'TR' ? 'üáπüá∑ –¢—É—Ä—Ü–∏—è' : 'üá∫üá¶ –£–∫—Ä–∞–∏–Ω–∞'}
                        </span>
                        <div class="discount-percent">
                            -${discount.discount}%
                        </div>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            ${discount.oldPrice?.amount ? `
                                <div class="price-old">
                                    ${discount.oldPrice.formatted}
                                </div>
                            ` : ''}
                            <div class="price-new">
                                ${discount.price?.formatted || '–¶–µ–Ω–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞'}
                            </div>
                        </div>
                        ${discount.oldPrice?.amount && discount.price?.amount ? `
                            <div style="text-align: right;">
                                <div style="font-size: 0.9em; color: #64748b;">
                                    –≠–∫–æ–Ω–æ–º–∏—è: ${Math.round(discount.oldPrice.amount - discount.price.amount)} ${discount.currency}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                    
                    <div class="discount-meta">
                        <div>
                            <i class="far fa-clock"></i>
                            ${daysLeft > 0 ? `${daysLeft} –¥–Ω.` : '–°–∫–æ—Ä–æ –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è'}
                        </div>
                        <div>
                            <i class="far fa-calendar"></i>
                            ${new Date(discount.checkedAt).toLocaleDateString('ru-RU')}
                        </div>
                    </div>
                </div>
            `;
        }
        
        // –ü–æ–∏—Å–∫ —Å–∫–∏–¥–æ–∫
        function searchDiscounts() {
            if (!currentDiscounts || currentDiscounts.length === 0) return;
            displayDiscounts(currentDiscounts);
        }
        
        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–∫–∏–¥–æ–∫
        function filterDiscounts() {
            if (!currentDiscounts || currentDiscounts.length === 0) return;
            displayDiscounts(currentDiscounts);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–≥—Ä
        async function updateGameImages() {
            try {
                showNotification('üîÑ –û–±–Ω–æ–≤–ª—è—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–≥—Ä...', 'info');
                const updatedGames = await discountsManager.fetchGameImages();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –µ—Å–ª–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∏–≥—Ä
                if (typeof displayGames === 'function') {
                    displayGames();
                }
                
                showNotification(`‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ ${updatedGames.filter(g => g.imageUrl).length} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π`, 'success');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:', error);
                showNotification('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π', 'error');
            }
        }
        
        // –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞
        function clearDiscountsCache() {
            if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∫—ç—à —Å–∫–∏–¥–æ–∫? –≠—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ —Ü–µ–Ω–∞—Ö.')) {
                localStorage.removeItem('discountsResults');
                localStorage.removeItem('discountsHistory');
                localStorage.removeItem('lastDiscountCheck');
                
                // –û—á–∏—â–∞–µ–º –≤—Å–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                Object.keys(localStorage).forEach(key => {
                    if (key.startsWith('discount_') || key.startsWith('cache_')) {
                        localStorage.removeItem(key);
                    }
                });
                
                showNotification('‚úÖ –ö—ç—à —Å–∫–∏–¥–æ–∫ –æ—á–∏—â–µ–Ω', 'success');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                document.getElementById('discountsList').innerHTML = `
                    <div class="no-discounts" style="grid-column: 1 / -1;">
                        <i class="fas fa-trash"></i>
                        <h3>–ö—ç—à –æ—á–∏—â–µ–Ω</h3>
                        <p>–ù–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∫–∏–¥–∫–∏ —Å–µ–π—á–∞—Å" –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö</p>
                    </div>
                `;
                document.getElementById('discountsList').style.display = 'grid';
                document.getElementById('noDiscountsSection').style.display = 'none';
                document.getElementById('discountsStats').style.display = 'none';
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
        function saveDiscountSettings() {
            const settings = {
                checkInterval: document.getElementById('checkInterval').value,
                minDiscountAlert: document.getElementById('minDiscountAlert').value,
                autoCheck: document.getElementById('autoCheck').checked,
                notifyBigDiscounts: document.getElementById('notifyBigDiscounts').checked,
                lastSave: new Date().toISOString()
            };
            
            localStorage.setItem('discountSettings', JSON.stringify(settings));
            showNotification('‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã', 'success');
            
            // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
            setupAutoRefresh();
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
        function loadDiscountSettings() {
            const settings = JSON.parse(localStorage.getItem('discountSettings')) || {
                checkInterval: '4',
                minDiscountAlert: '60',
                autoCheck: true,
                notifyBigDiscounts: true
            };
            
            document.getElementById('checkInterval').value = settings.checkInterval;
            document.getElementById('minDiscountAlert').value = settings.minDiscountAlert;
            document.getElementById('autoCheck').checked = settings.autoCheck;
            document.getElementById('notifyBigDiscounts').checked = settings.notifyBigDiscounts;
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        function setupAutoRefresh() {
            // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–π —Ç–∞–π–º–µ—Ä
            if (window.discountsRefreshTimer) {
                clearInterval(window.discountsRefreshTimer);
            }
            
            const settings = JSON.parse(localStorage.getItem('discountSettings')) || {};
            if (settings.autoCheck) {
                const intervalHours = parseInt(settings.checkInterval) || 4;
                const intervalMs = intervalHours * 60 * 60 * 1000;
                
                window.discountsRefreshTimer = setInterval(() => {
                    console.log('üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–∫–∏–¥–æ–∫');
                    updateDiscounts(false);
                }, intervalMs);
                
                console.log(`‚è∞ –ê–≤—Ç–æ–ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –Ω–∞ –∫–∞–∂–¥—ã–µ ${intervalHours} —á–∞—Å–æ–≤`);
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–æ–≤–µ—Ä–æ–∫
        function updateCheckTimes() {
            const lastCheck = localStorage.getItem('lastDiscountCheck');
            const lastCheckEl = document.getElementById('lastCheckTime');
            const nextCheckEl = document.getElementById('nextCheckTime');
            
            if (lastCheck) {
                const lastDate = new Date(lastCheck);
                lastCheckEl.textContent = lastDate.toLocaleString('ru-RU');
                
                const settings = JSON.parse(localStorage.getItem('discountSettings')) || {};
                const intervalHours = parseInt(settings.checkInterval) || 4;
                const nextDate = new Date(lastDate.getTime() + intervalHours * 60 * 60 * 1000);
                nextCheckEl.textContent = nextDate.toLocaleString('ru-RU');
            } else {
                lastCheckEl.textContent = '–ù–∏–∫–æ–≥–¥–∞';
                nextCheckEl.textContent = '–ù–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞';
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–æ–∫
        function updateCheckHistory() {
            const container = document.getElementById('checkHistory');
            const history = JSON.parse(localStorage.getItem('discountsHistory')) || [];
            
            if (history.length === 0) {
                container.innerHTML = '<div class="empty">–ü—Ä–æ–≤–µ—Ä–æ–∫ –µ—â–µ –Ω–µ –±—ã–ª–æ</div>';
                return;
            }
            
            container.innerHTML = history.map((entry, index) => {
                const date = new Date(entry.date);
                const successCount = entry.details?.filter(d => d.hasDiscounts).length || 0;
                
                return `
                    <div style="
                        padding: 15px;
                        margin-bottom: 10px;
                        background: ${index === 0 ? '#f0fdf4' : 'white'};
                        border-radius: 8px;
                        border: 1px solid ${index === 0 ? '#bbf7d0' : '#e2e8f0'};
                    ">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <strong style="color: #1e293b;">${date.toLocaleString('ru-RU')}</strong>
                            <span style="
                                background: ${successCount > 0 ? '#10b981' : '#64748b'};
                                color: white;
                                padding: 2px 8px;
                                border-radius: 12px;
                                font-size: 0.85em;
                                font-weight: 600;
                            ">
                                ${successCount} —Å–æ —Å–∫–∏–¥–∫–∞–º–∏
                            </span>
                        </div>
                        <div style="color: #64748b; font-size: 0.9em;">
                            –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –∏–≥—Ä: ${entry.totalChecked || entry.details?.length || 0}
                        </div>
                        <div style="margin-top: 10px; font-size: 0.85em; color: #94a3b8;">
                            <i class="fas fa-clock"></i> –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ~${Math.round(entry.details?.length * 0.5)} —Å–µ–∫.
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // –û—Ç–∫—Ä—ã—Ç–∏–µ —Å—Å—ã–ª–∫–∏
        function openDiscountUrl(url) {
            if (url) {
                window.open(url, '_blank');
            } else {
                showNotification('‚ùå –°—Å—ã–ª–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
            }
        }
        
        // –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è showNotification –µ—Å–ª–∏ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞
        if (typeof showNotification === 'undefined') {
            window.showNotification = function(message, type = 'info', duration = 3000) {
                alert(`${type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : '‚ÑπÔ∏è'} ${message}`);
            };
        }
    </script>
</body>
</html>