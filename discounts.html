<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–∫—Ü–∏–∏ PS Store - –ú–µ–Ω–µ–¥–∂–µ—Ä –∞–∫–∫–∞—É–Ω—Ç–æ–≤</title>
    <link rel="stylesheet" href="style.css?v=20250115">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .discounts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .discount-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .discount-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .discount-percent {
            font-size: 1.8em;
            font-weight: 800;
            color: #ef4444;
        }
        
        .region-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
            color: white;
        }
        
        .region-tr { background: linear-gradient(135deg, #e63946 0%, #a4161a 100%); }
        .region-ua { background: linear-gradient(135deg, #0057b7 0%, #ffd700 100%); }
        
        .price-old {
            text-decoration: line-through;
            color: #94a3b8;
            font-size: 0.9em;
        }
        
        .price-new {
            font-size: 1.3em;
            font-weight: 700;
            color: #1e293b;
        }
        
        .no-discounts {
            text-align: center;
            padding: 50px 20px;
            color: #64748b;
            grid-column: 1 / -1;
        }
        
        .game-image {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
            margin-right: 15px;
        }


    .high-discount {
        border: 2px solid #ef4444;
        box-shadow: 0 0 15px rgba(239, 68, 68, 0.3);
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0% { box-shadow: 0 0 10px rgba(239, 68, 68, 0.3); }
        50% { box-shadow: 0 0 20px rgba(239, 68, 68, 0.6); }
        100% { box-shadow: 0 0 10px rgba(239, 68, 68, 0.3); }
    }
    
    .discount-badge {
        position: absolute;
        top: 15px;
        right: 15px;
        background: #ef4444;
        color: white;
        padding: 5px 10px;
        border-radius: 20px;
        font-weight: 800;
        font-size: 0.9em;
        z-index: 2;
    }
    
    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #64748b;
        grid-column: 1 / -1;
    }
    
    .empty-state i {
        font-size: 64px;
        margin-bottom: 20px;
        color: #cbd5e1;
    }
    </style>
</head>
<body>
    <!-- –ú–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é -->
    <div id="mobileMenu" class="mobile-menu">
        <div class="mobile-menu-header">
            <div class="user-info-mobile">
                <div class="user-avatar">üë§</div>
                <div>
                    <div class="user-name" id="mobileUserName"></div>
                    <div class="user-role" id="mobileUserRole"></div>
                </div>
            </div>
            <button class="close-menu" onclick="toggleMobileMenu()">√ó</button>
        </div>
        <div class="mobile-menu-nav"></div>
        <div class="mobile-menu-footer">
            <button onclick="logout()" class="btn btn-danger btn-block">
                <span>üö™</span> –í—ã–π—Ç–∏
            </button>
        </div>
    </div>

    <!-- –ë—É—Ä–≥–µ—Ä-–∫–Ω–æ–ø–∫–∞ -->
    <div class="burger-container">
        <button class="burger-btn" onclick="toggleMobileMenu()">
            <div class="burger-icon">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <div class="burger-label">–ú–µ–Ω—é</div>
        </button>
    </div>

    <!-- –û–≤–µ—Ä–ª–µ–π -->
    <div id="menuOverlay" class="menu-overlay" onclick="toggleMobileMenu()"></div>

    <div class="container">
        <h1><span>üéÆ</span><span>–ê–∫—Ü–∏–∏ PS Store</span></h1>
        
        <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
        <div class="section">
            <h2><i class="fas fa-fire"></i> –°–∫–∏–¥–∫–∏ –Ω–∞ –Ω–∞—à–∏ –∏–≥—Ä—ã</h2>
            
            <div class="discounts-controls" style="background: #f8fafc; padding: 20px; border-radius: 10px;">
                <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-bottom: 20px;">
                    <div style="flex: 1; min-width: 200px;">
                        <label for="searchDiscounts" style="display: block; margin-bottom: 8px; font-weight: 600;">
                            <i class="fas fa-search"></i> –ü–æ–∏—Å–∫ –∏–≥—Ä—ã:
                        </label>
                        <input type="text" id="searchDiscounts" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–≥—Ä—ã..." class="input">
                    </div>
                    
                    <div style="flex: 1; min-width: 200px;">
                        <label for="filterRegion" style="display: block; margin-bottom: 8px; font-weight: 600;">
                            <i class="fas fa-globe"></i> –†–µ–≥–∏–æ–Ω:
                        </label>
                        <select id="filterRegion" class="input">
                            <option value="all">–í—Å–µ —Ä–µ–≥–∏–æ–Ω—ã</option>
                            <option value="TR">üáπüá∑ –¢—É—Ä—Ü–∏—è</option>
                            <option value="UA">üá∫üá¶ –£–∫—Ä–∞–∏–Ω–∞</option>
                        </select>
                    </div>
                </div>
                
                <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                    <button onclick="updateDiscounts(true)" class="btn btn-success" style="flex: 1;">
                        <i class="fas fa-sync-alt"></i> –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∫–∏–¥–∫–∏ —Å–µ–π—á–∞—Å
                    </button>
                </div>
            </div>

            <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –ø—Ä–æ–≤–µ—Ä–∫–∏ -->
            <div id="discountsProgress" style="display: none; background: #eff6ff; padding: 20px; border-radius: 10px; margin: 20px 0;"></div>

            <!-- –ó–∞–≥—Ä—É–∑–∫–∞ -->
            <div id="discountsLoading" style="text-align: center; padding: 40px; display: none;">
                <div class="loading" style="display: inline-block; width: 40px; height: 40px;"></div>
                <p style="margin-top: 15px; color: #64748b;">–ó–∞–≥—Ä—É–∂–∞—é —Å–ø–∏—Å–æ–∫ –∏–≥—Ä...</p>
            </div>

            <!-- –ù–µ—Ç –∏–≥—Ä -->
            <div id="noGamesAlert" style="display: none; text-align: center; padding: 40px;">
                <div style="font-size: 60px; color: #cbd5e1; margin-bottom: 20px;">üéÆ</div>
                <h3>–ù–µ—Ç –∏–≥—Ä –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è</h3>
                <button onclick="location.href='games.html'" class="btn btn-primary">
                    <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä—ã
                </button>
            </div>

            <!-- –°–ø–∏—Å–æ–∫ —Å–∫–∏–¥–æ–∫ -->
            <div id="discountsList" class="discounts-grid"></div>
        </div>
    </div>

    <!-- –°–ö–†–ò–ü–¢–´ -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="firebase.js"></script>
    <script src="security.js"></script>
    <script src="script.js?v=20250115"></script>
    <script src="psstore-api.js"></script>
    <script src="discounts.js?v=20250115"></script>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let discountsManager = null;
        let currentDiscounts = [];

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–∫–∏–¥–æ–∫ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –º–µ–Ω–µ–¥–∂–µ—Ä
            discountsManager = new DiscountsManager();
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
            initDiscountsPage();
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å–∫–∏–¥–æ–∫
        function initDiscountsPage() {
    console.log('üîç –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–∫–∏–¥–æ–∫...');
    
    const loadingEl = document.getElementById('discountsLoading');
    const noGamesAlert = document.getElementById('noGamesAlert');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ –∏–≥—Ä—ã
    const myGames = JSON.parse(localStorage.getItem('games')) || [];
    console.log(`üìÇ –ò–≥—Ä –≤ –±–∞–∑–µ: ${myGames.length}`);
    
    if (myGames.length === 0) {
        if (loadingEl) loadingEl.style.display = 'none';
        if (noGamesAlert) noGamesAlert.style.display = 'block';
        return;
    }
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    const cachedDiscounts = JSON.parse(localStorage.getItem('discountsResults')) || [];
    console.log(`üì¶ –í—Å–µ–≥–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π: ${cachedDiscounts.length}`);
    
    // –§–ò–õ–¨–¢–†–£–ï–ú –¢–û–õ–¨–ö–û –ò–ì–†–´ –°–û –°–ö–ò–î–ö–ê–ú–ò –î–ê–ñ–ï –í –ö–≠–®–ï
    const filteredCachedDiscounts = cachedDiscounts.filter(item => {
        const discounts = item.discounts || {};
        return (discounts.TR && discounts.TR.discount > 0) || 
               (discounts.UA && discounts.UA.discount > 0);
    });
    
    console.log(`‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–≥—Ä —Å–æ —Å–∫–∏–¥–∫–∞–º–∏: ${filteredCachedDiscounts.length}`);
    
    if (filteredCachedDiscounts.length > 0) {
        displayDiscounts(filteredCachedDiscounts);
        if (loadingEl) loadingEl.style.display = 'none';
    } else {
        if (loadingEl) loadingEl.style.display = 'none';
        document.getElementById('discountsList').innerHTML = `
            <div class="empty-state">
                <i class="fas fa-tags"></i>
                <h3>–°–∫–∏–¥–æ–∫ –ø–æ–∫–∞ –Ω–µ—Ç</h3>
                <p>–ù–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∫–∏–¥–∫–∏ —Å–µ–π—á–∞—Å" —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</p>
                <button onclick="updateDiscounts(true)" class="btn btn-success" style="margin-top: 20px;">
                    <i class="fas fa-search"></i> –ù–∞–π—Ç–∏ —Å–∫–∏–¥–∫–∏
                </button>
            </div>
        `;
    }
}

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∫–∏–¥–æ–∫
        async function updateDiscounts(force = false) {
            console.log('üîÑ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–∫–∏–¥–æ–∫');
            
            try {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
                document.getElementById('discountsLoading').style.display = 'block';
                document.getElementById('discountsList').innerHTML = '';
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–µ–Ω–µ–¥–∂–µ—Ä
                if (!discountsManager) {
                    discountsManager = new DiscountsManager();
                }
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É
                const results = await discountsManager.checkDiscounts(force);
                console.log(`üìä –ü–æ–ª—É—á–µ–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: ${results?.length || 0}`);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                document.getElementById('discountsLoading').style.display = 'none';
                
                if (results && results.length > 0) {
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º
                    localStorage.setItem('discountsResults', JSON.stringify(results));
                    displayDiscounts(results);
                    
                    // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                    alert(`‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ ${results.length} –∏–≥—Ä`);
                } else {
                    document.getElementById('discountsList').innerHTML = `
                        <div class="no-discounts">
                            <i class="fas fa-exclamation-circle"></i>
                            <h3>–°–∫–∏–¥–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                        </div>
                    `;
                }
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:', error);
                document.getElementById('discountsLoading').style.display = 'none';
                
                document.getElementById('discountsList').innerHTML = `
                    <div class="no-discounts">
                        <i class="fas fa-bug"></i>
                        <h3>–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏</h3>
                        <p>${error.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}</p>
                    </div>
                `;
                
                alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–∫–∏–¥–æ–∫
        function displayDiscounts(discountsData) {
    console.log('üé® –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–∫–∏–¥–∫–∏:', discountsData?.length || 0);
    
    const container = document.getElementById('discountsList');
    if (!container) return;
    
    // –ü–†–û–í–ï–†–Ø–ï–ú –ï–°–¢–¨ –õ–ò –î–ê–ù–ù–´–ï –°–û –°–ö–ò–î–ö–ê–ú–ò
    if (!discountsData || discountsData.length === 0) {
        container.innerHTML = `
            <div class="no-discounts">
                <i class="fas fa-tag"></i>
                <h3>–°–∫–∏–¥–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
                <p>–í –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –Ω–∏ –Ω–∞ –æ–¥–Ω—É –∏–∑ –≤–∞—à–∏—Ö –∏–≥—Ä –Ω–µ—Ç —Å–∫–∏–¥–æ–∫</p>
                <button onclick="updateDiscounts(true)" class="btn btn-primary" style="margin-top: 15px;">
                    <i class="fas fa-sync-alt"></i> –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –µ—â–µ —Ä–∞–∑
                </button>
            </div>
        `;
        return;
    }
    
    // –§–ò–õ–¨–¢–†–£–ï–ú –¢–û–õ–¨–ö–û –ò–ì–†–´ –°–û –°–ö–ò–î–ö–ê–ú–ò (–¥–≤–æ–π–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞)
    const gamesWithRealDiscounts = discountsData.filter(item => {
        const discounts = item.discounts || {};
        
        // –ò–≥—Ä–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç –µ—Å–ª–∏:
        // 1. –ï—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ –¢—É—Ä—Ü–∏–∏ –ò —Å–∫–∏–¥–∫–∞ > 0
        if (discounts.TR && discounts.TR.discount > 0) return true;
        
        // 2. –ï—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ –£–∫—Ä–∞–∏–Ω–µ –ò —Å–∫–∏–¥–∫–∞ > 0
        if (discounts.UA && discounts.UA.discount > 0) return true;
        
        // 3. –ò–ª–∏ –∏–≥—Ä–∞ –ø–æ–º–µ—á–µ–Ω–∞ –∫–∞–∫ —Ä–∞—Å–ø—Ä–æ–¥–∞–∂–∞
        if (discounts.TR?.isOnSale || discounts.UA?.isOnSale) return true;
        
        return false;
    });
    
    console.log(`‚úÖ –ò–≥—Ä —Å–æ —Å–∫–∏–¥–∫–∞–º–∏ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏: ${gamesWithRealDiscounts.length}`);
    
    // –ï–°–õ–ò –ü–û–°–õ–ï –§–ò–õ–¨–¢–†–ê–¶–ò–ò –ù–ò–ß–ï–ì–û –ù–ï –û–°–¢–ê–õ–û–°–¨
    if (gamesWithRealDiscounts.length === 0) {
        container.innerHTML = `
            <div class="no-discounts">
                <i class="fas fa-search"></i>
                <h3>–ê–∫—Ç–∏–≤–Ω—ã—Ö —Å–∫–∏–¥–æ–∫ –Ω–µ—Ç</h3>
                <p>–í—Å–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —Å–∫–∏–¥–∫–∏ —É–∂–µ –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å –∏–ª–∏ –±—ã–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã</p>
                <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
                    <button onclick="updateDiscounts(true)" class="btn btn-success">
                        <i class="fas fa-sync-alt"></i> –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ–π—á–∞—Å
                    </button>
                    <button onclick="location.href='games.html'" class="btn btn-primary">
                        <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä—ã
                    </button>
                </div>
            </div>
        `;
        return;
    }
    
    // –°–û–†–¢–ò–†–£–ï–ú –ü–û –†–ê–ó–ú–ï–†–£ –°–ö–ò–î–ö–ò (—Å–∞–º—ã–µ –±–æ–ª—å—à–∏–µ —Å–∫–∏–¥–∫–∏ –ø–µ—Ä–≤—ã–º–∏)
    const sortedGames = gamesWithRealDiscounts.sort((a, b) => {
        const aDiscount = Math.max(
            a.discounts?.TR?.discount || 0,
            a.discounts?.UA?.discount || 0
        );
        const bDiscount = Math.max(
            b.discounts?.TR?.discount || 0,
            b.discounts?.UA?.discount || 0
        );
        return bDiscount - aDiscount; // –ü–æ —É–±—ã–≤–∞–Ω–∏—é
    });
    
    // –°–û–ó–î–ê–ï–ú HTML –¢–û–õ–¨–ö–û –î–õ–Ø –ò–ì–† –°–û –°–ö–ò–î–ö–ê–ú–ò
    const html = sortedGames.map(item => {
        const game = item.game || { name: '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è' };
        const discounts = item.discounts || {};
        
        const trData = discounts.TR || {};
        const uaData = discounts.UA || {};
        
        const hasTR = trData.price && trData.price.amount > 0 && trData.discount > 0;
        const hasUA = uaData.price && uaData.price.amount > 0 && uaData.discount > 0;
        
        // –ï—Å–ª–∏ –Ω–∏ –≤ –æ–¥–Ω–æ–º —Ä–µ–≥–∏–æ–Ω–µ –Ω–µ—Ç —Å–∫–∏–¥–∫–∏ - –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —ç—Ç—É –∏–≥—Ä—É
        if (!hasTR && !hasUA) return '';
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —Å–∫–∏–¥–∫—É –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏
        const maxDiscount = Math.max(
            trData.discount || 0,
            uaData.discount || 0
        );
        
        return `
            <div class="discount-card ${maxDiscount >= 70 ? 'high-discount' : ''}">
                <div style="padding: 20px;">
                    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å–∫–∏–¥–∫–µ -->
                    <div style="display: flex; align-items: center; margin-bottom: 20px;">
                        ${game.imageUrl ? `
                            <img src="${game.imageUrl}" class="game-image">
                        ` : `
                            <div style="width: 100px; height: 100px; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); 
                                 border-radius: 8px; display: flex; align-items: center; justify-content: center; 
                                 color: white; font-size: 2em; margin-right: 15px;">
                                ${maxDiscount >= 70 ? 'üî•' : 'üéÆ'}
                            </div>
                        `}
                        <div style="flex: 1;">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                <h3 style="margin: 0 0 5px 0; color: #1e293b;">${game.name}</h3>
                                ${maxDiscount >= 50 ? `
                                    <div style="background: #ef4444; color: white; padding: 4px 12px; 
                                         border-radius: 20px; font-weight: 800; font-size: 1.1em;">
                                        üî• -${maxDiscount}%
                                    </div>
                                ` : ''}
                            </div>
                            <div style="color: #64748b; font-size: 0.9em;">
                                –û–±–Ω–æ–≤–ª–µ–Ω–æ: ${new Date(item.checkedAt || Date.now()).toLocaleTimeString('ru-RU', {hour: '2-digit', minute:'2-digit'})}
                            </div>
                        </div>
                    </div>
                    
                    <!-- –°–∫–∏–¥–∫–∏ -->
                    <div style="display: flex; flex-direction: column; gap: 15px;">
                        ${hasTR ? `
                            <div style="background: #fff5f5; padding: 15px; border-radius: 8px; border-left: 4px solid #dc2626;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <span class="region-badge region-tr">üáπüá∑ –¢—É—Ä—Ü–∏—è</span>
                                    <div class="discount-percent">-${trData.discount}%</div>
                                </div>
                                <div>
                                    ${trData.oldPrice?.amount > trData.price.amount ? `
                                        <div class="price-old">${trData.oldPrice.formatted}</div>
                                    ` : ''}
                                    <div class="price-new">${trData.price.formatted}</div>
                                </div>
                                ${trData.discount >= 60 ? `
                                    <div style="margin-top: 10px; padding: 5px 10px; background: #fecaca; 
                                         border-radius: 6px; font-size: 0.85em; color: #991b1b;">
                                        <i class="fas fa-bolt"></i> –í—ã–≥–æ–¥–Ω–æ!
                                    </div>
                                ` : ''}
                            </div>
                        ` : ''}
                        
                        ${hasUA ? `
                            <div style="background: #eff6ff; padding: 15px; border-radius: 8px; border-left: 4px solid #2563eb;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <span class="region-badge region-ua">üá∫üá¶ –£–∫—Ä–∞–∏–Ω–∞</span>
                                    <div class="discount-percent">-${uaData.discount}%</div>
                                </div>
                                <div>
                                    ${uaData.oldPrice?.amount > uaData.price.amount ? `
                                        <div class="price-old">${uaData.oldPrice.formatted}</div>
                                    ` : ''}
                                    <div class="price-new">${uaData.price.formatted}</div>
                                </div>
                                ${uaData.discount >= 60 ? `
                                    <div style="margin-top: 10px; padding: 5px 10px; background: #bfdbfe; 
                                         border-radius: 6px; font-size: 0.85em; color: #1e40af;">
                                        <i class="fas fa-bolt"></i> –í—ã–≥–æ–¥–Ω–æ!
                                    </div>
                                ` : ''}
                            </div>
                        ` : ''}
                    </div>
                    
                    <!-- –ö–Ω–æ–ø–∫–∏ -->
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        ${game.storeLinks?.TR && hasTR ? `
                            <button onclick="window.open('${game.storeLinks.TR}', '_blank')" 
                                    class="btn btn-small" style="flex: 1; background: #dc2626; color: white;">
                                <i class="fas fa-external-link-alt"></i> –ö—É–ø–∏—Ç—å –≤ –¢—É—Ä—Ü–∏–∏
                            </button>
                        ` : ''}
                        
                        ${game.storeLinks?.UA && hasUA ? `
                            <button onclick="window.open('${game.storeLinks.UA}', '_blank')" 
                                    class="btn btn-small" style="flex: 1; background: #2563eb; color: white;">
                                <i class="fas fa-external-link-alt"></i> –ö—É–ø–∏—Ç—å –≤ –£–∫—Ä–∞–∏–Ω–µ
                            </button>
                        ` : ''}
                    </div>
                </div>
            </div>
        `;
    }).filter(html => html !== '').join(''); // –£–¥–∞–ª—è–µ–º –ø—É—Å—Ç—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
    
    container.innerHTML = html;
    
    // –ï—Å–ª–∏ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ HTML –ø—É—Å—Ç–æ–π
    if (!html.trim()) {
        container.innerHTML = `
            <div class="no-discounts">
                <i class="fas fa-filter"></i>
                <h3>–ü–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Å–∫–∏–¥–æ–∫ –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å</h3>
                <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∫–∏–¥–∫–∏ –ø–æ–∑–∂–µ</p>
            </div>
        `;
    }
}

        // –§—É–Ω–∫—Ü–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function showNotification(message, type = 'info') {
            alert(type === 'error' ? '‚ùå ' : '‚úÖ ' + message);
        }
    </script>
    <!-- –î–æ–±–∞–≤—å –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã–≤–∞—é—â–∏–º </body> -->
<script>
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    async function checkServerStatus() {
        try {
            const response = await fetch('https://ps-store-api.onrender.com/api/test', {
                method: 'GET',
                timeout: 5000
            });
            
            if (response.ok) {
                console.log('‚úÖ –°–µ—Ä–≤–µ—Ä —Å–∫–∏–¥–æ–∫ –¥–æ—Å—Ç—É–ø–µ–Ω');
                return true;
            } else {
                console.warn('‚ö†Ô∏è –°–µ—Ä–≤–µ—Ä —Å–∫–∏–¥–æ–∫ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                return false;
            }
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É:', error);
            return false;
        }
    }
    
    // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–µ—Ä–≤–µ—Ä
    document.addEventListener('DOMContentLoaded', async function() {
        const isServerAvailable = await checkServerStatus();
        
        if (!isServerAvailable) {
            const container = document.getElementById('discountsList');
            if (container) {
                container.innerHTML = `
                    <div class="no-discounts">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>–°–µ—Ä–≤–µ—Ä –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</h3>
                        <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∫–∏–¥–æ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ</p>
                        <p style="font-size: 0.9em; color: #64748b; margin-top: 10px;">
                            –†–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ—è–≤—è—Ç—Å—è –∫–æ–≥–¥–∞ —Å–µ—Ä–≤–µ—Ä –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç
                        </p>
                    </div>
                `;
            }
        }
    });
</script>
</body>
</html>