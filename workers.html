<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞–º–∏</title>
    <link rel="stylesheet" href="style.css?v=20250115">
</head>
<body>
    <div id="mobileMenu" class="mobile-menu">
        <div class="mobile-menu-header">
            <div class="user-info-mobile">
                <div class="user-avatar">üë§</div>
                <div>
                    <div class="user-name" id="mobileUserName"></div>
                    <div class="user-role" id="mobileUserRole"></div>
                </div>
            </div>
            <button class="close-menu" onclick="toggleMobileMenu()">√ó</button>
        </div>
        
        <div class="mobile-menu-nav">
            <!-- –ü—É–Ω–∫—Ç—ã –º–µ–Ω—é –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —Å–∫—Ä–∏–ø—Ç–æ–º -->
        </div>
        
        <div class="mobile-menu-footer">
            <button onclick="logout()" class="btn btn-danger btn-block">
                <span>üö™</span> –í—ã–π—Ç–∏
            </button>
        </div>
    </div>

    <!-- –ë—É—Ä–≥–µ—Ä-–∫–Ω–æ–ø–∫–∞ -->
    <div class="burger-container">
        <button class="burger-btn" onclick="toggleMobileMenu()" title="–û—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é">
            <div class="burger-icon">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <!-- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –±–µ–π–¥–∂ —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏ -->
            <div class="burger-badge" id="menuBadge" style="display: none;">3</div>
            <!-- –¢–µ–∫—Å—Ç –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ (—Ç–æ–ª—å–∫–æ –Ω–∞ –ü–ö) -->
            <div class="burger-label">–ú–µ–Ω—é</div>
        </button>
    </div>

    <!-- –û–≤–µ—Ä–ª–µ–π –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–µ–Ω—é -->
    <div id="menuOverlay" class="menu-overlay" onclick="toggleMobileMenu()"></div>
    
    <div class="container">
        <h1><span>üëë</span><span>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞–º–∏</span></h1>
        
        <!-- –ü—Ä—è–º–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç, –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–¥–º–∏–Ω–∞ -->
        <div id="adminContent">
            <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–Ω–∏–∫–∞ -->
            <div class="section">
                <h2>‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ä–∞–±–æ—Ç–Ω–∏–∫–∞</h2>
                <div class="form-grid">
                    <input type="text" id="workerName" placeholder="–ò–º—è —Ä–∞–±–æ—Ç–Ω–∏–∫–∞" class="input" required>
                    <input type="text" id="workerLogin" placeholder="–õ–æ–≥–∏–Ω" class="input" required>
                    <input type="password" id="workerPassword" placeholder="–ü–∞—Ä–æ–ª—å" class="input" required>
                    <input type="password" id="workerConfirmPassword" placeholder="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" class="input" required>
                    
                    <div style="grid-column: 1 / -1; padding: 10px;">
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="workerActive" checked>
                            <span>–ê–∫–∫–∞—É–Ω—Ç –∞–∫—Ç–∏–≤–µ–Ω</span>
                        </label>
                    </div>
                    
                    <button onclick="addWorker()" class="btn btn-success" style="grid-column: 1 / -1;">
                        –î–æ–±–∞–≤–∏—Ç—å —Ä–∞–±–æ—Ç–Ω–∏–∫–∞
                    </button>
                </div>
            </div>

            <!-- –°–ø–∏—Å–æ–∫ —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤ -->
            <div class="section">
                <h2>üìã –°–ø–∏—Å–æ–∫ —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤</h2>
                <div id="workersList" class="list">
                    <div class="empty">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="firebase.js"></script>
    <script src="security.js"></script>
    <script src="script.js?v=20250115"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            const user = security.getCurrentUser();
            if (!user) {
                window.location.href = 'login.html';
                return;
            }
            
            // –ü—Ä–æ—Å—Ç–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –º–µ–Ω—é
            initMobileMenu();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤ —Å—Ä–∞–∑—É
            loadWorkers();
        });
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤ (–ø—Ä–æ—Å—Ç–∞—è –≤–µ—Ä—Å–∏—è)
        function loadWorkers() {
            try {
                const workersStr = localStorage.getItem('workers');
                let workers = workersStr ? JSON.parse(workersStr) : [];
                
                // –ï—Å–ª–∏ –Ω–µ—Ç —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ, —Å–æ–∑–¥–∞–µ–º –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤
                if (!workersStr) {
                    localStorage.setItem('workers', JSON.stringify([]));
                }
                
                displayWorkers(workers);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤:', error);
                document.getElementById('workersList').innerHTML = `
                    <div class="empty">
                        <div style="color: #f72585; margin-bottom: 10px;">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>
                        <button onclick="loadWorkers()" class="btn btn-small">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button>
                    </div>
                `;
            }
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤
        function displayWorkers(workers) {
            const workersList = document.getElementById('workersList');
            
            if (!workers || workers.length === 0) {
                workersList.innerHTML = `
                    <div class="empty">
                        <div style="font-size: 50px; margin-bottom: 15px;">üë•</div>
                        <h3>–ù–µ—Ç —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤</h3>
                        <p>–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–≥–æ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞</p>
                    </div>
                `;
                return;
            }
            
            workersList.innerHTML = workers.map(worker => `
                <div class="item" style="margin-bottom: 15px; padding: 20px; border-radius: 10px; background: rgba(255,255,255,0.8); border: 1px solid #eee;">
                    <div style="display: flex; justify-content: space-between; align-items: start; flex-wrap: wrap; gap: 10px; margin-bottom: 10px;">
                        <div>
                            <strong>${worker.name || worker.username || '–ë–µ–∑ –∏–º–µ–Ω–∏'}</strong>
                            <div style="color: #666; font-size: 0.9em; margin-top: 5px;">
                                –õ–æ–≥–∏–Ω: ${worker.username || '–ù–µ —É–∫–∞–∑–∞–Ω'} | 
                                –î–æ–±–∞–≤–ª–µ–Ω: ${worker.created || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}
                            </div>
                        </div>
                        <div>
                            <span style="padding: 4px 10px; border-radius: 20px; font-size: 0.85em; background: ${(worker.active !== false) ? '#e8f5e9' : '#ffebee'}; color: ${(worker.active !== false) ? '#2e7d32' : '#c62828'};">
                                ${(worker.active !== false) ? '‚úÖ –ê–∫—Ç–∏–≤–µ–Ω' : '‚ùå –ù–µ–∞–∫—Ç–∏–≤–µ–Ω'}
                            </span>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap;">
                        <button class="btn btn-small ${(worker.active !== false) ? 'btn-warning' : 'btn-success'}" 
                                onclick="toggleWorker('${worker.username}', ${(worker.active !== false) ? 'false' : 'true'})">
                            ${(worker.active !== false) ? '–î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å' : '–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å'}
                        </button>
                        <button class="btn btn-danger btn-small" 
                                onclick="deleteWorker('${worker.username}')">
                            –£–¥–∞–ª–∏—Ç—å
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        // –î–æ–±–∞–≤–∏—Ç—å —Ä–∞–±–æ—Ç–Ω–∏–∫–∞
        function addWorker() {
            const name = document.getElementById('workerName').value.trim();
            const username = document.getElementById('workerLogin').value.trim();
            const password = document.getElementById('workerPassword').value;
            const confirmPassword = document.getElementById('workerConfirmPassword').value;
            const active = document.getElementById('workerActive').checked;
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            if (!name || !username || !password) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }
            
            if (password !== confirmPassword) {
                alert('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç');
                return;
            }
            
            if (password.length < 4) {
                alert('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 4 —Å–∏–º–≤–æ–ª–∞');
                return;
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤
            let workers = [];
            try {
                const workersStr = localStorage.getItem('workers');
                workers = workersStr ? JSON.parse(workersStr) : [];
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤:', e);
                workers = [];
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –ª–æ–≥–∏–Ω–∞
            if (workers.find(w => w.username === username)) {
                alert('–¢–∞–∫–æ–π –ª–æ–≥–∏–Ω —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
                return;
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–≥–æ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞
            const newWorker = {
                name: name,
                username: username,
                password: security.hashPassword(password), // –•–µ—à–∏—Ä—É–µ–º –ø–∞—Ä–æ–ª—å
                active: active,
                created: new Date().toLocaleString('ru-RU'),
                role: 'worker'
            };
            
            workers.push(newWorker);
            
            try {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
                localStorage.setItem('workers', JSON.stringify(workers));
                
                // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
                document.getElementById('workerName').value = '';
                document.getElementById('workerLogin').value = '';
                document.getElementById('workerPassword').value = '';
                document.getElementById('workerConfirmPassword').value = '';
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
                loadWorkers();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                alert(`–†–∞–±–æ—Ç–Ω–∏–∫ "${name}" –¥–æ–±–∞–≤–ª–µ–Ω!`);
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–∞–±–æ—Ç–Ω–∏–∫–∞');
            }
        }
        
        // –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Ä–∞–±–æ—Ç–Ω–∏–∫–∞
        function toggleWorker(username, active) {
            if (!confirm(`${active ? '–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å' : '–î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å'} —Ä–∞–±–æ—Ç–Ω–∏–∫–∞?`)) {
                return;
            }
            
            let workers = [];
            try {
                const workersStr = localStorage.getItem('workers');
                workers = workersStr ? JSON.parse(workersStr) : [];
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤:', e);
                alert('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö');
                return;
            }
            
            const workerIndex = workers.findIndex(w => w.username === username);
            
            if (workerIndex === -1) {
                alert('–†–∞–±–æ—Ç–Ω–∏–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω');
                return;
            }
            
            workers[workerIndex].active = active;
            
            try {
                localStorage.setItem('workers', JSON.stringify(workers));
                loadWorkers();
                alert(`–°—Ç–∞—Ç—É—Å —Ä–∞–±–æ—Ç–Ω–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω!`);
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
            }
        }
        
        // –£–¥–∞–ª–∏—Ç—å —Ä–∞–±–æ—Ç–Ω–∏–∫–∞
        function deleteWorker(username) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞?')) {
                return;
            }
            
            let workers = [];
            try {
                const workersStr = localStorage.getItem('workers');
                workers = workersStr ? JSON.parse(workersStr) : [];
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤:', e);
                alert('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö');
                return;
            }
            
            workers = workers.filter(w => w.username !== username);
            
            try {
                localStorage.setItem('workers', JSON.stringify(workers));
                loadWorkers();
                alert(`–†–∞–±–æ—Ç–Ω–∏–∫ —É–¥–∞–ª–µ–Ω!`);
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è:', error);
                alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è');
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –º–µ–Ω—é
        function initMobileMenu() {
            const user = security.getCurrentUser();
            if (!user) return;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –º–µ–Ω—é
            document.getElementById('mobileUserName').textContent = user.name || user.username;
            document.getElementById('mobileUserRole').textContent = 
                user.role === 'admin' ? '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä üëë' : '–†–∞–±–æ—Ç–Ω–∏–∫ üë∑';
            
            // –ü—É–Ω–∫—Ç—ã –º–µ–Ω—é
            const menuItems = [
                { icon: 'üéÆ', text: '–ü–∞–Ω–µ–ª—å –º–µ–Ω–µ–¥–∂–µ—Ä–∞', page: 'manager.html' },
                { icon: '‚ûï', text: '–î–æ–±–∞–≤–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç', page: 'add-account.html' },
                { icon: 'üìã', text: '–°–ø–∏—Å–æ–∫ –∞–∫–∫–∞—É–Ω—Ç–æ–≤', page: 'accounts.html' },
                { icon: 'üÜì', text: '–°–≤–æ–±–æ–¥–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã', page: 'free-accounts.html' },
                { icon: 'üéØ', text: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–∞–º–∏', page: 'games.html' },
                { icon: 'üìä', text: '–û—Ç—á–µ—Ç—ã', page: 'reports.html' },
                { icon: 'üìà', text: '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤', page: 'workers-stats.html' },
                { icon: 'üî•', text: '–ê–∫—Ü–∏–∏ PS Store', page: 'discounts.html' },
                { icon: 'üëë', text: '–†–∞–±–æ—Ç–Ω–∏–∫–∏', page: 'workers.html' }
            ];
            
            const menuNav = document.querySelector('.mobile-menu-nav');
            menuNav.innerHTML = '';
            
            menuItems.forEach(item => {
                const menuItem = document.createElement('a');
                menuItem.className = 'mobile-menu-item';
                menuItem.href = item.page;
                menuItem.onclick = function() {
                    toggleMobileMenu();
                };
                
                menuItem.innerHTML = `
                    <span style="margin-right: 15px; font-size: 1.3rem;">${item.icon}</span>
                    <span>${item.text}</span>
                `;
                
                menuNav.appendChild(menuItem);
            });
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–æ–±–∏–ª—å–Ω–æ–≥–æ –º–µ–Ω—é
        function toggleMobileMenu() {
            const menu = document.getElementById('mobileMenu');
            const overlay = document.getElementById('menuOverlay');
            const burgerBtn = document.querySelector('.burger-btn');
            
            menu.classList.toggle('active');
            overlay.classList.toggle('active');
            burgerBtn.classList.toggle('active');
            
            if (menu.classList.contains('active')) {
                document.body.style.overflow = 'hidden';
            } else {
                document.body.style.overflow = 'auto';
            }
        }
        
        // –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
        function logout() {
            security.logout();
        }
    </script>
</body>
</html>