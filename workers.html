<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–∞–±–æ—Ç–Ω–∏–∫–∏ - –ú–µ–Ω–µ–¥–∂–µ—Ä –∏–≥—Ä–æ–≤—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>üëë –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞–º–∏</h1>
        
        <div class="nav-buttons"></div>

        <div id="accessDenied" class="section" style="display: none;">
            <div class="empty">
                <h2>üö´ –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω</h2>
                <p>–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é —Ä–∞–±–æ—Ç–Ω–∏–∫–∞–º–∏</p>
                <button onclick="location.href='manager.html'" class="btn btn-primary">–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –ø–∞–Ω–µ–ª—å</button>
            </div>
        </div>

        <div id="adminContent" style="display: none;">
            <div class="section">
                <h2>‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ä–∞–±–æ—Ç–Ω–∏–∫–∞</h2>
                <div class="form-grid">
                    <input type="text" id="newWorkerName" placeholder="–§–ò–û —Ä–∞–±–æ—Ç–Ω–∏–∫–∞" class="input" required>
                    <input type="text" id="newWorkerLogin" placeholder="–õ–æ–≥–∏–Ω" class="input" required>
                    <input type="password" id="newWorkerPassword" placeholder="–ü–∞—Ä–æ–ª—å" class="input" required>
                    <button onclick="addNewWorker()" class="btn btn-success" style="grid-column: 1 / -1;">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞–±–æ—Ç–Ω–∏–∫–∞</button>
                </div>
            </div>

            <div class="section">
                <h2>üìã –°–ø–∏—Å–æ–∫ —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤</h2>
                <div id="workersList" class="list"></div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script src="auth.js"></script>
    <script src="workers.js"></script>
    <script>
        function checkAccess() {
            if (!auth.isAdmin()) {
                document.getElementById('accessDenied').style.display = 'block';
                document.getElementById('adminContent').style.display = 'none';
            } else {
                document.getElementById('accessDenied').style.display = 'none';
                document.getElementById('adminContent').style.display = 'block';
                displayWorkers();
            }
        }

        function addNewWorker() {
            if (!auth.isAdmin()) {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤');
                return;
            }

            const workerData = {
                name: document.getElementById('newWorkerName').value,
                username: document.getElementById('newWorkerLogin').value,
                password: document.getElementById('newWorkerPassword').value
            };

            if (workersManager.addWorker(workerData)) {
                alert('–†–∞–±–æ—Ç–Ω–∏–∫ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!');
                displayWorkers();
                document.getElementById('newWorkerName').value = '';
                document.getElementById('newWorkerLogin').value = '';
                document.getElementById('newWorkerPassword').value = '';
            }
        }

        function displayWorkers() {
            if (!auth.isAdmin()) return;

            const workersList = document.getElementById('workersList');
            const workers = workersManager.getWorkers();

            if (workers.length === 0) {
                workersList.innerHTML = '<div class="empty">–ù–µ—Ç —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤</div>';
                return;
            }

            workersList.innerHTML = workers.map(worker => `
                <div class="item">
                    <div class="account-info">
                        <strong>${worker.name}</strong>
                        <div>
                            <small>–õ–æ–≥–∏–Ω: ${worker.username} | –†–æ–ª—å: ${worker.role === 'admin' ? 'üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' : 'üë∑ –†–∞–±–æ—Ç–Ω–∏–∫'}</small>
                            <br>
                            <small>–î–æ–±–∞–≤–ª–µ–Ω: ${new Date(worker.created).toLocaleDateString('ru-RU')} | 
                            –°—Ç–∞—Ç—É—Å: ${worker.active ? '‚úÖ –ê–∫—Ç–∏–≤–µ–Ω' : '‚ùå –ù–µ–∞–∫—Ç–∏–≤–µ–Ω'}</small>
                        </div>
                    </div>
                    <div>
                        ${worker.id !== auth.currentUser.id ? 
                            `<button class="btn btn-danger btn-small" onclick="deleteWorker(${worker.id})">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>` : 
                            '<span class="current-user">–≠—Ç–æ –≤—ã</span>'
                        }
                    </div>
                </div>
            `).join('');
        }

        function deleteWorker(workerId) {
            if (!auth.isAdmin()) {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤');
                return;
            }

            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞?')) {
                if (workersManager.deleteWorker(workerId)) {
                    displayWorkers();
                }
            }
        }

        document.addEventListener('DOMContentLoaded', checkAccess);
    </script>
</body>
</html>